# Starbucks__DecisionTrees
Capstone project of Udacity course. Got event data of an experiment. Main task was to restructure the data and derive success or fail drivers

## Table of contents

- [Data used](#data-used)
- [Libraries used](#libraries-used)
- [Business Questions](#business_questions)
- [Content of Notebook](#content_of_notebook)
- [Summary](#summary)

## Data used
The data is contained in three files:

* portfolio.json - containing offer ids and meta data about each offer (duration, type, etc.)
* profile.json - demographic data for each customer
* transcript.json - records for transactions, offers received, offers viewed, and offers completed

**portfolio.json**
* id (string) - offer id
* offer_type (string) - type of offer ie BOGO, discount, informational
* difficulty (int) - minimum required spend to complete an offer
* reward (int) - reward given for completing an offer
* duration (int) - time for offer to be open, in days
* channels (list of strings)

**profile.json**
* age (int) - age of the customer 
* became_member_on (int) - date when customer created an app account
* gender (str) - gender of the customer (note some entries contain 'O' for other rather than M or F)
* id (str) - customer id
* income (float) - customer's income

**transcript.json**
* event (str) - record description (ie transaction, offer received, offer viewed, etc.)
* person (str) - customer id
* time (int) - time in hours since start of test. The data begins at time t=0
* value - (dict of strings) - either an offer id or transaction amount depending on the record



## Libraries used

- matplotlib
- seaborn
- pandas
- numpy
- SQLAlchemy
- sklearn

## Business Questions
### Definition
- An offer is **active**, if it has been viewed by the customer and if it is still valid.
- An offer is **passive**, if it has been viewed by the customer and if it is still valid.
- Same holds true for transactions
- A transaction is **independent**, if it was done during a period, where no offer is valid
- If a transaction happens during a period, where two offers are valid, I allocate a share of the transaction to each offer
- I use reward and cost in the same way as rewards are costs for starbucks

### Questions

In this analysis I tried to answer 4 business questions
- Which offer drives most revenue? (Passive and active)
- Which offer costs most? (Passive rewards and active rewards)
- Which person have the highest passive rewards? --> These persons would by anyway. We should identify them and save the costs
- Can I use machine learning to identify passive rewards drivers?

## Content of Notebook
1. Introduction
2. Dataset
3. Data Preparation basic
   1. portfolio
   2. profile
   3. transcript
4. Data understanding basic
   1. barplots of offers per person
   2. barplot of unique offers per person
   3. Offers per timeslot
5. Define cleaning function to get a temporary dataframe
   1. Get temporary dataframe before grouping
      a. Perform health checks to make sure that total sums stay the same after wrangling     
   2. Create two dataframes for machine learning

6. ETL pipeline
7. ML Pipeline  
8. ML insights
 

## Summary
### Both Dataframes enable us to run a decision tree and to identify the groups with the highest loss. The highest passive losses are generated by the people with the highest income. Apparently they do not view the offer and purchase anyway

### Decision tree grouped by person
* Example 1: Certain leaves have very high passive rewards per person (6Dollar - 8Dollar)
   * e.g. age_bucket not like 118 (which means the age is known)
   * bogo_count>=2 (which mens that the person received at least 2 bogo offers during the testing period)
   * income_bucket is > = (96000-12000) (which means that it is high income customers)
   * Id received = 0b1e1539f2cc45b7b9fa7c272da2e1d7 (Discount offer with 20 difficulty and 10 duration)
* Example 2:
   * age_bucket not like 118 (which means the age is known)
   * bogo_count>=2 (which mens that the person received at least 2 bogo offers during the testing period)
   * income_bucket is < = (96000-12000) (which means that it is high income customers)
   * Is female
   * Received 9b98b8c7a33c4b65b9aebfe6a799e6d9 (bogo offer with 5 difficulty and 7 duration)
![alt text](https://github.com/EriRika/Starbucks__DecisionTrees/blob/master/RegressionPerson.png)

### Decision tree grouped by person and offer
* Example 1:
   * Offer is not reward_5 offer
   * Offer is reward_10 offer
   * Income bucket is known
   * Income is > = (96000-12000)
![alt text](https://github.com/EriRika/Starbucks__DecisionTrees/blob/master/RegressionPersonOffer.png)

   
[Medium Post - How Decision trees can help to find success drivers?](https://erikagintautas.medium.com/how-decision-trees-can-help-to-find-success-drivers-17edce59e1be)


